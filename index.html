<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro diario</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: auto;
      padding: 10px;
    }

    h1 {
      text-align: center;
    }

    button {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      margin: 10px 0;
    }

    input[type="date"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
    }

    .panel {
      background: #f5f5f5;
      padding: 10px;
      margin-top: 15px;
      font-size: 14px;
    }

    canvas {
      margin-top: 20px;
    }
  </style>
</head>

<body>

<h1>Registro diario</h1>

<button onclick="agregarRegistro('PIPI')">PIP√ç</button>
<button onclick="agregarRegistro('CACA')">CACA</button>

<input type="date" id="fecha">

<div class="panel" id="resumen"></div>

<canvas id="grafico"></canvas>

<div class="panel" id="registros"></div>

<script>
/* =====================
   ESTADO
===================== */

let registros = JSON.parse(localStorage.getItem("registros") || "[]");
let chart;

/* =====================
   FECHA
===================== */

const picker = document.getElementById("fecha");

function hoyISO() {
  const d = new Date();
  d.setHours(0,0,0,0);
  return d.toISOString().split("T")[0];
}

picker.value = hoyISO();

/* =====================
   REGISTROS
===================== */

function agregarRegistro(tipo) {
  registros.push({
    tipo,
    fecha: new Date().toISOString()
  });

  localStorage.setItem("registros", JSON.stringify(registros));
  render();
}

/* =====================
   UTIL
===================== */

function ultimos7Dias() {
  const base = new Date(picker.value);
  base.setHours(0,0,0,0);

  const dias = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(base);
    d.setDate(base.getDate() - i);
    dias.push(d);
  }
  return dias;
}

/* =====================
   RESUMEN
===================== */

function renderResumen() {
  const cont = document.getElementById("resumen");
  const dias = ultimos7Dias();

  let html = "<strong>√öltimos 7 d√≠as:</strong><br>";

  dias.forEach(d => {
    let p = 0, c = 0;

    registros.forEach(r => {
      const fr = new Date(r.fecha);
      if (fr.toDateString() === d.toDateString()) {
        if (r.tipo === "PIPI") p++;
        if (r.tipo === "CACA") c++;
      }
    });

    html += `${d.toLocaleDateString("es-AR", {
      weekday: "long",
      day: "2-digit",
      month: "2-digit"
    })}: üíß ${p} | üí© ${c}<br>`;
  });

  cont.innerHTML = html;
}

/* =====================
   LISTADO
===================== */

function renderRegistros() {
  const cont = document.getElementById("registros");

  cont.innerHTML = "<strong>Registros:</strong><br>" +
    registros.slice().reverse().map(r => {
      const f = new Date(r.fecha);
      return `${r.tipo} ‚Äì ${f.toLocaleString("es-AR")}`;
    }).join("<br>");
}

/* =====================
   GRAFICO (SCATTER)
===================== */

function renderGrafico() {
  const dias = ultimos7Dias();

  const pipi = [];
  const caca = [];

  registros.forEach(r => {
    const f = new Date(r.fecha);

    dias.forEach(d => {
      if (f.toDateString() === d.toDateString()) {
        const xLabel = d.toLocaleDateString("es-AR", {
          weekday: "short",
          day: "2-digit",
          month: "2-digit"
        });

        const y = f.getHours() + f.getMinutes() / 60;

        const point = { x: xLabel, y };

        if (r.tipo === "PIPI") pipi.push(point);
        if (r.tipo === "CACA") caca.push(point);
      }
    });
  });

  if (chart) chart.destroy();

  chart = new Chart(document.getElementById("grafico"), {
    type: "scatter",
    data: {
      datasets: [
        {
          label: "PIP√ç",
          data: pipi,
          pointRadius: 6
        },
        {
          label: "CACA",
          data: caca,
          pointRadius: 6
        }
      ]
    },
    options: {
      scales: {
        y: {
          min: 0,
          max: 24,
          ticks: {
            callback: v => {
              const h = Math.floor(v);
              const m = Math.round((v - h) * 60);
              return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;
            }
          },
          title: {
            display: true,
            text: "Hora"
          }
        },
        x: {
          title: {
            display: true,
            text: "D√≠a"
          }
        }
      }
    }
  });
}

/* =====================
   RENDER
===================== */

function render() {
  renderResumen();
  renderGrafico();
  renderRegistros();
}

picker.addEventListener("change", render);

render();
</script>

</body>
</html>
