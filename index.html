<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro BebÃ©</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  text-align: center;
  padding: 15px;
}

button {
  font-size: 18px;
  padding: 12px 20px;
  margin: 8px;
  border-radius: 10px;
  border: none;
}

#pipi { background: #4fc3f7; }
#caca { background: #a1887f; }
#undo { background: #e57373; }
#excel { background: #81c784; }

input[type="date"] {
  font-size: 16px;
  padding: 6px;
  margin: 10px;
}

canvas {
  max-width: 100%;
  margin-top: 20px;
}
</style>
</head>

<body>

<h2>Registro BebÃ© ðŸ‘¶</h2>

<button id="pipi">ðŸ’§ PipÃ­</button>
<button id="caca">ðŸ’© Caca</button>
<button id="undo">â†© Deshacer</button>
<br>

<label>Semana terminando en:</label><br>
<input type="date" id="datePicker"><br>

<button id="excel">â¬‡ Descargar Excel</button>

<canvas id="chart"></canvas>

<script>
let registros = JSON.parse(localStorage.getItem("registros") || "[]");

function guardar(tipo) {
  registros.push({
    tipo,
    fecha: new Date().toISOString()
  });
  localStorage.setItem("registros", JSON.stringify(registros));
  render();
}

function deshacer() {
  registros.pop();
  localStorage.setItem("registros", JSON.stringify(registros));
  render();
}

document.getElementById("pipi").onclick = () => guardar("pipi");
document.getElementById("caca").onclick = () => guardar("caca");
document.getElementById("undo").onclick = deshacer;

const picker = document.getElementById("datePicker");
picker.valueAsDate = new Date();
picker.onchange = render;

document.getElementById("excel").onclick = exportarExcel;

let chart;

function render() {
  const endDate = new Date(picker.value);
  endDate.setHours(23,59,59,999);

  const days = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(endDate);
    d.setDate(d.getDate() - i);
    days.push(d);
  }

  const labels = days.map(d =>
    d.toLocaleDateString("es-AR", {
      weekday: "short",
      day: "2-digit",
      month: "2-digit"
    })
  );

  const pipiData = [];
  const cacaData = [];

  days.forEach(d => {
    const inicio = new Date(d);
    inicio.setHours(0,0,0,0);
    const fin = new Date(d);
    fin.setHours(23,59,59,999);

    const pipis = registros.filter(r =>
      r.tipo === "pipi" &&
      new Date(r.fecha) >= inicio &&
      new Date(r.fecha) <= fin
    ).length;

    const cacas = registros.filter(r =>
      r.tipo === "caca" &&
      new Date(r.fecha) >= inicio &&
      new Date(r.fecha) <= fin
    ).length;

    pipiData.push(pipis || null);
    cacaData.push(cacas || null);
  });

  if (chart) chart.destroy();

  chart = new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
      labels,
      datasets: [
        { label: "ðŸ’§ PipÃ­", data: pipiData, backgroundColor: "#4fc3f7" },
        { label: "ðŸ’© Caca", data: cacaData, backgroundColor: "#a1887f" }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1 }
        }
      }
    }
  });
}

function exportarExcel() {
  let csv = "Tipo,Fecha,Hora\n";

  registros.forEach(r => {
    const d = new Date(r.fecha);
    csv += `${r.tipo},${d.toLocaleDateString("es-AR")},${d.toLocaleTimeString("es-AR")}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "registro_bebe.csv";
  link.click();
}

render();
</script>

</body>
</html>
